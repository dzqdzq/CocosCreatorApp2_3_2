"use strict";const{ipcRenderer:ipcRenderer}=require("electron"),pkg=require("../package.json"),ipcFlag=`${pkg.name}@${pkg.version}`;let _senderID=0,_id2sender=Object.create(null);class Sender{static query(e){return _id2sender[e]}static remove(e){delete _id2sender[e]}constructor(e){this.id=_senderID++,e.cid=this.id,this.options=e}callback(e){return"function"!=typeof e?this:(this.options.needCallback=!0,_id2sender[this.id]=this,this._callback=e,this)}timeout(e){return clearTimeout(this._timer),"number"!=typeof e||e<0?this:(this._timer=setTimeout(()=>{this._callback&&this._callback(new Error("Message timeout")),delete _id2sender[this.id]},e),this)}}class MainSender extends Sender{constructor(e){super(e),process.nextTick(()=>{ipcRenderer.send(`${ipcFlag}:send`,e)})}}class EventSender extends Sender{constructor(e,r){super(r),process.nextTick(()=>{let s=this._callback,t={senderType:process.type,needCallback:r.needCallback,reply(...e){s&&s(...e),s=null}};e.forEach(e=>{e(t,...r.arguments)})})}}class WindowSender extends Sender{constructor(e,r){super(r),process.nextTick(()=>{e.send(`${ipcFlag}:send`,r)})}}exports.EventSender=EventSender,exports.MainSender=MainSender,exports.WindowSender=WindowSender;