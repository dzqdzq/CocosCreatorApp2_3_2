let e,n,s,i,a,t,r,o=require("./hashes.min.js"),u=require("path"),p=require("fs-extra");module.exports={gatherInfo(o){t=o.JsZip,a=o.cpk,i=o.gameConfig,s=o.title,e=o.buildPath,r=o.options,n=[]},isPluginSupport(e){let n=CocosEngine,s=parseInt(e.replace(/[^\d]/g,""));return parseInt(n.slice(0,6).replace(/[^\d]/g,""))>=s},organizeResources(){if(!0===this.isPluginSupport("2.4.0")){let o=i.subpackages=[];for(var s=0,a=r.bundles.length;s<a;s++){var t=r.bundle[s];if(!bundles.isSubpackage)continue;let i=t.bundleName,a=u.join(e,"subpackages",i);n.push(a),p.renameSync(u.join(a,"index.js"),u.join(a,"main.js")),o.push({name:i,root:i+"/"})}return}let o=r.buildResults._subpackages,c=i.subpackages=[];for(let s in o){if(!o.hasOwnProperty(s))continue;let i=o[s].name,a=u.join(e,"subpackages",i);n.push(a),p.renameSync(u.join(a,"index.js"),u.join(a,"main.js")),c.push({name:i,root:i+"/"})}},pack(){let i=u.join(e,"subpackages");n.forEach(function(e){let n=new t,a=u.win32.basename(e),r=o.CRC32(a+"/"),c=u.join(i,s+"."+r+".cpk");p.existsSync(c)&&p.unlinkSync(c);let l=p.createWriteStream(c);n.directory(e,a),n.generateNodeStream({type:"nodebuffer",base64:!1,compression:"DEFLATE"}).pipe(l).on("finish",function(){})})}};