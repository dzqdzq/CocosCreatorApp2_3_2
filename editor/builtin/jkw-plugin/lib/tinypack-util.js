let e,r,n,s,t,i,a=require("path"),o=require("fs-extra"),c=a.join(__dirname,"../","res"),l=(a.join(c,"jsb-adapter"),!1);module.exports={gatherInfo(o){e=o.cpk,l=!!o.customConfig.tinyPackageMode,s=!!o.customConfig.packFirstScreenRes,r=o.buildPath,i=o.options,t=o.startScene,n=a.join(r,"server")},async organizeResources(){},getAdaptTinyModeInMainJs(e){return!1===l||!1===this.isPluginSupport("2.4.0")?e:e.replace("cc.assetManager.loadBundle('assets/'","cc.assetManager.loadBundle(REMOTE_SERVER_ROOT + 'assets/'")},isPluginSupport(e){let r=CocosEngine,n=parseInt(e.replace(/[^\d]/g,""));return parseInt(r.slice(0,6).replace(/[^\d]/g,""))>=n},pack(){if(!1===l)return e.directory(a.join(r,"res"),"res"),void 0;if(!1===s)return;let c=a.join(n,"res","raw-assets"),d=a.join(r,"res","raw-assets");if(o.moveSync(d,c),o.removeSync(d),!0===this.isPluginSupport("2.4.0"))return i.bundles.array.forEach(e=>{let s=e.buildResults;for(var i=s.getDependencies(t),c=0;c<i.length;++c){var l=i[c],d=s.getNativeAssetPath(l);if(!d||0===d.length)continue;o.moveSync(e,d);let e=a.join(n,d.replace(r,""));var u=a.dirname(e);o.existsSync(u)&&0===o.readdirSync(u).length&&o.removeSync(u)}}),e.directory(a.join(r,"res"),"res"),void 0;let u=i.buildResults;for(var g=u.getDependencies(t),p=0;p<g.length;++p){var v=g[p],y=u.getNativeAssetPath(v);if(!y||0===y.length)continue;let e=a.join(n,y.replace(r,""));o.moveSync(e,y);var S=a.dirname(e);o.existsSync(S)&&0===o.readdirSync(S).length&&o.removeSync(S)}e.directory(a.join(r,"res"),"res")},packFinished(){!1!==l&&!1!==s&&(o.removeSync(a.join(r,"res")),o.moveSync(a.join(n,"res"),a.join(r,"res")),o.removeSync(n))}};