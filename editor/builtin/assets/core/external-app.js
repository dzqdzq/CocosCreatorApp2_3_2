"use strict";const e=require("electron"),t=e.ipcMain,i=require("child_process").spawn,o=require("path"),n=require("fire-fs"),r=require("plist"),s=Editor.Profile.load("global://settings.json");t.on("assets:open-text-file",function(t,i){if("default"===s.get("script-editor")){if(Editor.isWin32){return 1===Editor.Dialog.messageBox({type:"warning",buttons:[Editor.T("MESSAGE.cancel"),Editor.T("MESSAGE.yes")],title:Editor.T("MESSAGE.warning"),message:Editor.T("MESSAGE.warning"),detail:Editor.T("PREFERENCES.vacancy_script_editor_tips")})&&(Editor.Ipc.sendToMain("preferences:update-tab",1),Editor.Ipc.sendToPanel("preferences","update-tab",1),Editor.Panel.open("preferences")),void 0}let t=Editor.assetdb.uuidToFspath(i);e.shell.openItem(t)}else{let e=Editor.assetdb.uuidToFspath(i);e&&Editor.Ipc.sendToMain("assets:open-text-file-by-path",e)}}),t.on("assets:open-text-file-by-path",function(e,t){let a=s.get("script-editor");if("default"===a)return Editor.warn("Can not open "+t+" because text editor is not configured.");let d=[],p="";if("darwin"===process.platform){if(a.endsWith(".app")){a=o.join(a,"/Contents/MacOS/");let e=r.parse(n.readFileSync(o.join(a,"../Info.plist"),"utf8"));a=o.join(a,e.CFBundleExecutable)}-1!==a.indexOf("Visual Studio Code")?(p=a,d=[Editor.Project.path,t,"-n"]):(p="open",d=["-a",o.basename(a),t])}else-1!==a.indexOf("Code")?(p=a,d=[Editor.Project.path,t,"-r"]):(p=a,d=[t]);i(p,d,{detached:!0,stdio:"ignore"}).unref()}),t.on("assets:open-texture-file",function(e,t){let i=Editor.assetdb.uuidToFspath(t);i&&Editor.Ipc.sendToMain("assets:open-texture-file-by-path",i)}),t.on("assets:open-texture-file-by-path",function(e,t){let a=s.get("picture-editor-root");if(a){let e=[],s="";if("darwin"===process.platform){if(a.endsWith(".app")){a=o.join(a,"/Contents/MacOS/");let e=r.parse(n.readFileSync(o.join(a,"../Info.plist"),"utf8"));a=o.join(a,e.CFBundleExecutable)}s="open",e=["-a",a,t]}else s=a,e=[t];i(s,e,{detached:!0,stdio:"ignore"}).unref()}});