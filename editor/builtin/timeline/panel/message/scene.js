"use strict";const e=require("../libs/dump"),{promisify:t}=require("util"),i=require("../libs/advice"),n=require("../libs/manager");let a=!1;module.exports={ready(){this.vm.init()},reloading(){this.vm.init()},"animation-clips-changed"(t,i){i.node===e.root&&"cc.Animation"===i.component&&e.update(()=>{this.vm.updateState(),this.vm.updateClips()})},async"animation-clip-changed"(e,i){let a=await t(cc.AssetLibrary.loadJson)(i.data);a._uuid=i.uuid,n.unregister(a),n.register(a)},"animation-state-changed"(e,t){if("play"===t.state){this.vm.paused=!1,(async(e,t,n)=>{if(a)return;a=!0;let o=()=>{Editor.Ipc.sendToPanel("scene","scene:query-animation-time",{rootId:e,clip:t},(e,t)=>{let s=Math.round(t*n);i.emit("change-frame",s),a&&requestAnimationFrame(o)})};requestAnimationFrame(o)})(this.vm.hierarchy[0].id,this.vm.clip.name,this.vm.sample)}else this.vm.paused=!0,a=!1},async"animation-record-changed"(e,a){if(a){this.vm.record=!0;this.vm.hierarchy[0].id;let e=this.vm.clip.name;Editor.Ipc.sendToPanel("scene","scene:change-animation-current-clip",e)}else{this.vm.record=!1;let e=this.vm.clip?this.vm.clip.id:"";if(!e)return;let a=await t(cc.AssetLibrary.loadAsset)(e);n.unregister(a),n.register(a),i.emit("clip-data-update"),i.emit("change-event",-1),i.emit("change-eline",null),this.vm.init()}},"node-component-added"(t,i){i.node===e.root&&"cc.Animation"===i.component&&e.update(()=>{this.vm.updateState()})},"node-component-removed"(t,i){i.node===e.root&&e.update(()=>{this.vm.updateState()})},"node-component-pasted"(t,i){i.node===e.root&&"cc.Animation"===i.component&&e.update(()=>{this.vm.updateState()})},async"node-component-updated"(t,i){i.node&&i.node===e.root&&await this.vm.updateClips()}};