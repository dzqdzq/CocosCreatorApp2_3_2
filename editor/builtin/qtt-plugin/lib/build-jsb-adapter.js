const e=require("path"),r=(require("fs"),require("gulp")),n=(require("gulp-sourcemaps"),require("babelify")),i=require("browserify"),t=require("vinyl-source-stream"),s=(require("gulp-uglify"),require("vinyl-buffer"));require("async");const a={build:async function(a){let{isTinyPackage:o,rootPath:u,dstPath:l,excludedModules:c}=a;if(!u)throw new Error("Please specify the jsbAdapter path");console.time("build jsb-adapter"),await new Promise(a=>{let p=[];if(c&&c.length>0){let r=require(Editor.url("packages://jsb-adapter/modules.json"));c.forEach(function(n){r.some(function(r){if(r.name===n&&r.entries)return r.entries.forEach(function(r){p.push(e.join(u,r))}),!0})})}let d=[e.join(u,"./engine/index.js")];o&&d.push(e.join(u,"rt-adapter.js")),function(a,o,u){let l=e.basename(o);o=e.dirname(o);let c=i();a.forEach(function(e){c.add(e)}),u&&u.forEach(function(e){c.exclude(e)});let p=CocosEngine,d=parseInt("2.3.0".replace(/[^\d]/g,"")),f="env";return 1==parseInt(p.slice(0,6).replace(/[^\d]/g,""))>=d&&(f=require("@babel/preset-env")),c.transform(n,{presets:[f]}).bundle().pipe(t(l)).pipe(s()).pipe(r.dest(o))}(d,e.join(l,"engine","index.js"),p).on("end",a)}),console.timeEnd("build jsb-adapter")}};module.exports=a;