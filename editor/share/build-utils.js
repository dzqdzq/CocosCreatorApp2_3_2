const e=require("fire-fs"),t=require("fire-path"),o=Editor.require("app://editor/share/build-platforms");module.exports={combineDestJson({dest:o},r,i){try{let s=t.join(o,i),l=e.readJsonSync(s);Object.assign(l,r),Object.assign(r,l)}catch(e){}},combineBuildTemplateJson({actualPlatform:o},r,i){try{let s=t.join(Editor.Project.path,"build-templates",o,i),l=e.readJsonSync(s);Object.assign(r,l)}catch(e){}},getAbsoluteBuildPath:e=>(t.posix.isAbsolute(e)||t.win32.isAbsolute(e)||(e=t.join(Editor.Project.path,e)),e),getOptions(e,t){e||(e=Editor.isMainProcess?Editor.Profile.load("project://builder.json"):Editor.remote.Profile.load("project://builder.json")),t||(t=Editor.isMainProcess?Editor.Profile.load("local://builder.json"):Editor.remote.Profile.load("local://builder.json"));let o=Object.assign({},e.getSelfData(),t.getSelfData());return this.updateOptions(o),o},getCommonOptions:function(e){e||(e=this.getOptions());let t=Object.assign({},e);return delete t.keystorePath,delete t.keystorePassword,delete t.keystoreAlias,delete t.keystoreAliasPassword,t},updateOptions(e){let r=e.buildPath=this.getAbsoluteBuildPath(e.buildPath),i=t.join(r,this._getOutputDir(e.actualPlatform)||e.actualPlatform);o[e.platform].useTemplate&&(i=t.join(r,"jsb-"+e.template)),e.dest=i},_getOutputDir(e){let t=("browser"===process.type?Editor.Builder:Editor.remote.Builder).simpleBuildTargets[e];return t&&t.output||null},get defaultPackageName(){return"org.cocos2d.default"}};